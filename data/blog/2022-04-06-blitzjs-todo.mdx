---
slug: blitzjs-todo-redis
title: "Building A To-Do List with Blitz.js & Redis"
authors:
  - vedant
tags: [redis, blitzjs, upstash, todo]
---

Blitz.js is a React framework that was originally forked from Next.js. Today, weâll build a Blitz.js To-Do application that stores tasks in Upstash. Without further ado, letâs get started!

## Setup

Youâll need to install Blitz.js on your computer to get started.

NPM:

```shell
npm install -g blitz --legacy-peer-deps
```

Yarn:

```shell
yarn global add blitz
```

To create a new Blitz.js app, use `blitz new` and cd into the directory.

```
blitz new blitzjs-todo && cd blitzjs-todo
```

Great, now letâs install TailwindCSS to style our website.

```
blitz install tailwind
```

Lastly, let's install the Upstash JS SDK to make calls to the Upstash API easier.

NPM:

```
npm i @upstash/redis
```

Yarn:

```
yarn i @upstash/redis
```

At this point, you should run `blitz dev` to make sure everything is working correctly. Try making an account and signing in too. It should look like this if youâve done everything correctly so far.

![Default Blitz.js App](https://i.imgur.com/Z84Ws2L.png)

In addition, your file structure should look like this:

![File Structure Screenshot](https://i.imgur.com/tp2mA4W.png)

Copy these `UPSTASH_REDIS_REST_URL` and `UPSTASH_REDIS_REST_TOKEN` from the [Upstash Console](https://console.upstash.com/) into the file called `.env` for now. It should look like this:

```
# This env file should be checked into source control
# This is the place for default values for all environments
# Values in `.env.local` and `.env.production` will override these values

UPSTASH_REDIS_REST_URL=YOUR_URL_HERE
UPSTASH_REDIS_REST_TOKEN=YOUR_TOKEN_HERE
```

Weâve set up our Blitz.js application completely now! Letâs start implementing our To-Do list.

## Implementation

Blitz.js comes with User Authentication built in! Letâs leverage this to make private to-do lists for each user.

First, let's initialize the Upstash JS SDK in `/lib/redis.ts`

```ts
import { Redis } from "@upstash/redis";

const redis = Redis.fromEnv();
export default redis;
```

Weâll need to make **3** different API Routes to access our To-Do lists.

Navigate to `app/api` and make a file called `getall.ts`. Once youâve done so, paste the following code in:

```jsx
import { BlitzApiRequest, BlitzApiResponse, getSession } from "blitz";
import redis from "../../lib/redis";

export const handler = async (req: BlitzApiRequest, res: BlitzApiResponse) => {
  const session = await getSession(req, res);
  if (!session.userId) {
    res.status(401).json({ error: `Do not tamper with this route!` });
  } else {
    await redis
      .lrange(String(session.userId), 0, 100)
      .then((data) => res.status(200).json({ data: data, success: true }))
      .catch((error) => res.status(500).json({ error: error }));
  }
};
export default handler;
```

Letâs go over how this API Route works, step by step. First, we make a request to the route. On the route itself, we validate that the user is logged in. If there is no user, we return a âNot Authorizedâ response. If there **is** a user, then we fetch our Upstash Redis database to find all To-Dos that are currently in the list. This will fetch about a hundred To-Dos.

> Q: Wait, how are we supposed to add To-Dos in the first place?
> A: Good question! Letâs do that next!

Once again, paste the following code into a new file called `add.ts` in `app/api`.

```jsx
import { BlitzApiRequest, BlitzApiResponse, getSession } from "blitz";
import redis from "../../lib/redis";
const handler = async (req: BlitzApiRequest, res: BlitzApiResponse) => {
  the session = await getSession(req, res);
  if (req.method !== "POST" || !req.body.data || !session.userId) {
    res.status(401).json({ error: `Do not tamper with this route!` });
  } else {
    let todo = encodeURI(req.body.data);
    await redis
      .lpush(String(session.userId), todo)
      .then(() => res.status(200).json({ success: true }))
      .catch(() => res.status(500).json({ error: "Error adding data." }));
  }
};
export default handler;
```

This API route is quite similar to the last one, but notice that weâve added more checks on the fifth line. Thatâs because this request is not a `GET` request; rather, it is a `POST` request. Notice how we check for **three things.** First, we make sure that the request is actually a `POST` request. Next, we ensure that there is JSON or text in `req.body.data`. Finally, we make sure the user is logged in. If all these little checks are passed, we can push our To-Do to our Redis list on Upstash. If there is any sort of error while fetching, we can return a 500 by using `.catch`.

The last route we need to add is one to remove our To-Dos. Once you finish something, you have to cross it out of course! Letâs add our last API Route in `app/api/remove.ts`. Copy the following code into the file:

```jsx
import { BlitzApiRequest, BlitzApiResponse, getSession } from "blitz";
import redis from "../../lib/redis";
const handler = async (req: BlitzApiRequest, res: BlitzApiResponse) =>ieties